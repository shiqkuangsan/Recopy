# FR-002: 来源 App 检测

## 基本信息

- **优先级**：P1
- **状态**：待开发
- **关联**：M1-8, FR-003
- **依赖**：无

## 背景

当前剪贴板条目的 `source_app` 和 `source_app_name` 字段始终为空字符串（lib.rs 中标记为 `TODO: M1-8`）。卡片底部的来源应用名称无法显示。

## 需求描述

当剪贴板内容变化时，检测是哪个应用触发了复制操作，将应用名称和 bundle ID 存入数据库。

## 跨平台方案

### macOS

使用 `NSWorkspace.shared.frontmostApplication` 获取：
- `localizedName` → source_app_name
- `bundleIdentifier` → source_app

可通过 osascript 实现：
```
tell application "System Events" to get {name, bundle identifier} of first process whose frontmost is true
```

或通过 Rust `objc` crate 直接调用 NSWorkspace API。

### Windows

使用 Win32 API：
- `GetForegroundWindow()` → 获取窗口句柄
- `GetWindowThreadProcessId()` → 获取进程 ID
- `OpenProcess()` + `QueryFullProcessImageName()` → 获取进程路径/名称

## 验收标准

- [ ] 从 VSCode 复制文本，卡片底部显示 "Visual Studio Code"
- [ ] 从浏览器复制，显示 "Chrome" / "Safari" 等
- [ ] 从 EasyCV 自身粘贴不应覆盖原始来源
- [ ] 来源信息持久化到数据库，重启后保留

## 注意事项

- 检测时机：剪贴板变化事件触发时立即获取 frontmost app
- EasyCV 自身操作（如粘贴写入剪贴板）应跳过来源检测
