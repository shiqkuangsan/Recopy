# FR-001: 焦点回退到前台应用

## 基本信息

- **优先级**：P0
- **状态**：待开发
- **关联**：M8-6, BUG-001
- **依赖**：无（不依赖 FR-002 来源 App 检测）

## 背景

用户在其他应用（如 VSCode、QQ）中呼出 EasyCV，选择一条记录后按 Enter 粘贴。当前 `window.hide()` 只隐藏窗口但不会让 macOS 把焦点还给之前的应用（标题栏仍显示 EasyCV），导致模拟 Cmd+V 发送给了 EasyCV 自身。

## 需求描述

EasyCV 显示时记录之前的前台应用，粘贴时先激活该应用再模拟粘贴。

## 跨平台方案

### macOS

1. **记录前台应用**：`show_main_window()` 时执行 osascript
   ```
   tell application "System Events" to get name of first process whose frontmost is true
   ```
   将结果存入内存（如 Tauri State 或全局变量）

2. **激活前台应用**：粘贴时执行
   ```
   tell application "XXX" to activate
   ```
   等待短暂延迟后模拟 Cmd+V

### Windows

1. **记录前台窗口**：`show_main_window()` 时调用 `GetForegroundWindow()` 保存 HWND
2. **激活前台窗口**：粘贴时调用 `SetForegroundWindow(saved_hwnd)` + `SendInput()` 模拟 Ctrl+V

## 验收标准

- [ ] macOS: 在 VSCode 中呼出 EasyCV → 选中记录 → Enter → VSCode 恢复焦点且内容粘贴到光标处
- [ ] macOS: 在 Terminal 中同样流程可正常粘贴
- [ ] Windows: 同样流程可正常粘贴（待 Windows 环境验证）
- [ ] 不影响 Cmd+C 复制（复制不需要焦点回退）

## 技术要点

- 使用 `AtomicPtr` 或 `Mutex<String>` 存储前台应用名/HWND
- `simulate_paste()` 中增加激活前台应用的步骤
- 激活后需等待约 100-200ms 让目标应用完成焦点切换
