# Recopy V1 产品需求文档（PRD）

> **Archive Notice**: 本文档是 Recopy（原名 EasyCV）V1 产品需求文档。
> 记录了产品立项时的完整需求定义，含功能需求、非功能需求、数据模型和用户流程。
> V1.0 已于 2026-02-27 发布并全面投入使用。
>
> 原始日期：2026-02-23 | 归档日期：2026-03-02

---

## Retrospective: 需求实现状况

| 需求 | 计划 | 实际 | 说明 |
|------|------|------|------|
| FR-01 剪贴板监听 | ✅ | ✅ 完整实现 | 纯文本/富文本/图片/文件全支持 |
| FR-02 主面板 UI | ✅ | ✅ 完整实现 | 毛玻璃卡片流 + NSPanel |
| FR-03 搜索与过滤 | ✅ | ✅ 完整实现 | FTS5 + 类型过滤 |
| FR-04 收藏 | ✅ | ✅ 完整实现 | Pin + 收藏视图 |
| FR-05 分组管理 | ✅ | ❌ **已移除** | 竞品调研后简化 |
| FR-06 粘贴操作 | ✅ | ✅ macOS 完整，Windows 部分 | Windows 自动粘贴待实现 |
| FR-07 隐私/排除 | ✅ | ⚠️ 部分实现 | App 排除列表为 placeholder |
| FR-08 系统托盘 | ✅ | ✅ 完整实现 | 含 i18n 菜单 |
| FR-09 设置 | ✅ | ✅ 大部分实现 | App 排除列表待完善 |
| 单条上限 | 50MB | **10MB**（可配 1-100MB） | 决策阶段下调 |
| 协议 | 待定 | **PolyForm Noncommercial** | - |
| macOS 最低版本 | 13.0 | **12.0** | 扩大兼容范围 |

---

## 一、产品概述

Recopy 是一款跨平台剪贴板历史管理工具，提供类 Paste 的视觉化卡片交互体验。用户在 macOS 和 Windows 上获得一致的剪贴板管理能力：自动记录每一次复制（纯文本、富文本、图片、文件），通过搜索快速查找，通过收藏持久管理。

### 核心价值主张

```
"你的每一次复制，都不会再丢失。"
```

- 对标 Paste 的视觉化体验
- 跨平台统一体验（macOS + Windows）
- 完整的多源复制支持（纯文本 / 富文本 / 图片 / 文件）

### 目标用户

- 日常在 Mac 和/或 Windows 上频繁使用复制粘贴的知识工作者
- 对系统原生剪贴板历史不满的用户
- 开发者、设计师、写作者等高频复制粘贴场景

---

## 二、功能需求

### FR-01 剪贴板监听与自动记录

**描述**：后台持续监听系统剪贴板变化，自动记录每一次复制操作。

| 子项 | 要求 | 实际状态 |
|------|------|---------|
| FR-01.1 | 支持纯文本、富文本（HTML）、图片（PNG/JPG 等）、单文件 | ✅ |
| FR-01.2 | 保存：内容、类型、来源应用名称、时间戳、大小、内容哈希 | ✅ |
| FR-01.3 | 去重：相同内容更新 `updated_at` 而非新建记录 | ✅ |
| FR-01.4 | 历史条数无上限，持久存储 | ✅ |
| FR-01.5 | 单条大小上限可配置（默认 10MB，范围 1-100MB），超出自动跳过 | ✅ |

**额外实现**：
- 目录复制自动跳过（不记录）
- 文件缩略图异步生成，不阻塞主流程
- 图片原图存文件系统 `{app_data}/images/{YYYY-MM}/{uuid}.png`

---

### FR-02 主面板 UI（核心交互）

**描述**：通过全局快捷键一键呼出主面板，以视觉化卡片流展示剪贴板历史。

| 子项 | 要求 | 实际状态 |
|------|------|---------|
| FR-02.1 | 全局快捷键呼出/隐藏（默认 `Cmd+Shift+V` / `Ctrl+Shift+V`，可自定义） | ✅ |
| FR-02.2 | 水平卡片流展示，按时间分组，最新在最前 | ✅ |
| FR-02.3 | 差异化预览：纯文本截断、图片缩略图、文件类型图标、富文本预览 | ✅ |
| FR-02.4 | 辅助信息：来源 App 名称 + 相对时间 | ✅（名称，无图标） |
| FR-02.5 | 点击/回车粘贴到前台 App，同时关闭面板 | ✅ |
| FR-02.6 | 键盘优先：方向键浏览、回车粘贴、Esc 关闭、输入即搜索 | ✅ |
| FR-02.7 | 失焦自动关闭（可配置） | ✅ |

**额外实现**：
- macOS NSPanel 非激活浮动窗口（不抢焦点）
- 毛玻璃背景效果（Glassmorphism）
- Cmd+C / 双击复制 + HUD 反馈窗口

---

### FR-03 搜索与过滤

| 子项 | 要求 | 实际状态 |
|------|------|---------|
| FR-03.1 | 呼出面板后搜索框自动聚焦 | ✅ |
| FR-03.2 | FTS5 全文搜索，支持中文子串匹配 | ✅ |
| FR-03.3 | 150ms debounce 实时过滤 | ✅ |
| FR-03.4 | 按类型过滤：All / Text / Rich / Image / File | ✅ |
| FR-03.5 | 空结果提示 | ✅ |

**额外实现**：
- IME 输入法支持（compositionstart/end 避免中文输入时误触搜索）

---

### FR-04 收藏（Pin）

| 子项 | 要求 | 实际状态 |
|------|------|---------|
| FR-04.1 | 右键菜单标记收藏 | ✅ |
| FR-04.2 | 收藏条目不受清理策略影响 | ✅ |
| FR-04.3 | 收藏视图/Tab | ✅ |
| FR-04.4 | 历史流中有星标标记 | ✅ |
| FR-04.5 | 可取消收藏 | ✅ |

---

### ~~FR-05 分组管理~~ （已移除）

> **移除原因**：经竞品调研，分组功能属于重度用户付费特性。对于 Recopy 的定位，
> 收藏 + 搜索 + 类型筛选已足够覆盖绝大多数使用场景。约 430 行代码已移除。

---

### FR-06 粘贴操作

| 子项 | 要求 | 实际状态 |
|------|------|---------|
| FR-06.1 | 主粘贴：写入剪贴板 → 关闭面板 → 模拟 Cmd+V | ✅ macOS |
| FR-06.2 | 纯文本粘贴选项 | ✅ |
| FR-06.3 | 仅复制到剪贴板（不粘贴、不关闭面板） | ✅ |

**关键实现细节（Paste Flow）**：
1. `pasteItem()` → `invoke("paste_clipboard_item")`
2. Rust 写内容到系统剪贴板
3. `platform_resign_before_paste()` — 同步 main-thread（NSPanel 让出焦点）
4. `simulate_paste()` — osascript Cmd+V，50ms 延迟
5. `platform_hide_window()` — 异步（避免 blur handler 死锁）

---

### FR-07 隐私与排除规则

| 子项 | 要求 | 实际状态 |
|------|------|---------|
| FR-07.1 | App 排除列表 | ⏳ placeholder |
| FR-07.2 | 预置排除密码管理器 | ⏳ |
| FR-07.3 | 一键清空（保留收藏，二次确认） | ✅ |
| FR-07.4 | 单条删除 | ✅ |
| FR-07.5 | 数据完全本地存储 | ✅ |

---

### FR-08 系统托盘 / 菜单栏

| 子项 | 要求 | 实际状态 |
|------|------|---------|
| FR-08.1 | macOS 菜单栏 / Windows 托盘常驻 | ✅ |
| FR-08.2 | 左键打开面板 | ✅ |
| FR-08.3 | 右键菜单（设置、退出等） | ✅ 含 i18n |
| FR-08.4 | 暂停/恢复监听 | ⏳ 未实现 |

**额外实现**：
- 托盘图标 tooltip 显示应用名

---

### FR-09 设置

| 子项 | 要求 | 实际状态 |
|------|------|---------|
| FR-09.1 | 快捷键自定义 | ✅ 录制 UI |
| FR-09.2 | 开机自启动 | ✅ |
| FR-09.3 | 历史保留策略（unlimited/days/count） | ✅ |
| FR-09.4 | App 排除列表 | ⏳ placeholder |
| FR-09.5 | 外观：dark/light/system | ✅ |
| FR-09.6 | 语言：中/英/system | ✅ |
| FR-09.7 | 失焦自动关闭开关 | ✅ |
| FR-09.8 | 单条大小上限配置（1-100MB） | ✅ |

**额外实现**：
- About 页面含 GitHub、官网、反馈链接
- 手动检查更新按钮
- 更新状态管理（下载进度、安装、错误处理）

---

## 三、非功能需求

### NFR-01 性能

| 指标 | 要求 | 实际 |
|------|------|------|
| 快捷键到面板出现 | ≤ 200ms | ✅ |
| 搜索响应 | ≤ 100ms | ✅ |
| 剪贴板监听延迟 | ≤ 500ms | ✅ |
| 内存占用（空闲时） | ≤ 100MB | ✅ |
| 安装包体积 | ≤ 30MB | ✅（DMG ~8MB） |

### NFR-02 兼容性

| 平台 | 计划最低版本 | 实际最低版本 |
|------|-----------|-----------|
| macOS | 13.0 (Ventura) | **12.0 (Monterey)** |
| Windows | Windows 10 (1809) | Windows 10 (1809) |

### NFR-03 数据安全

- 所有数据本地存储，零网络通信（除自动更新检查外）
- SQLite WAL 模式，最大 5 连接池
- 数据库不加密

### NFR-04 安装与分发

| 渠道 | 计划 | 实际 |
|------|------|------|
| macOS .dmg | ✅ | ✅ |
| macOS Homebrew | ✅ | ✅ `brew install --cask darkingtail/tap/recopy` |
| Windows NSIS | ✅ | ✅ |
| Windows winget | ✅ | ⏳ 未提交 |
| 自动更新 | ✅ | ✅ tauri-plugin-updater |

---

## 四、V1 范围外的功能

| 功能 | 状态 | 说明 |
|------|------|------|
| ~~分组管理~~ | ❌ 已移除 | 收藏 + 搜索足够 |
| Paste Stack（批量粘贴） | ❌ 未来考虑 | |
| 云同步 / 跨设备同步 | ❌ | 复杂度高 |
| 移动端 | ❌ | 桌面优先 |
| AI 能力 | ❌ | 保持工具纯粹 |
| OCR | ❌ | |
| 内容编辑 | ❌ | |
| 格式转换 | ❌ | |
| Linux 支持 | ❌ | |
| 暂停/恢复监听 | ⏳ | 后续版本 |
| App 排除列表 | ⏳ | 后续版本 |

---

## 五、信息架构

```
Recopy
├── 主面板（快捷键呼出）
│   ├── 搜索框（自动聚焦，输入即搜索，IME 友好）
│   ├── 类型过滤 Tab（全部 / 文本 / 富文本 / 图片 / 文件）
│   ├── 视图切换（History / Pins）
│   └── 卡片流区域（水平滚动，日期分组）
│       └── 卡片 × N
│           ├── 内容预览
│           ├── 来源 App 名称 + 相对时间
│           ├── 收藏星标
│           └── 右键菜单（粘贴/纯文本粘贴/复制/收藏/删除）
├── HUD 窗口（复制反馈，140×140，800ms 自动关闭）
├── 系统托盘/菜单栏
│   ├── 左键 → 打开主面板
│   └── 右键菜单（显示/设置/退出）
└── 设置窗口（640×520）
    ├── 通用（快捷键、自启、语言、外观、失焦关闭、大小上限）
    ├── 历史（保留策略、清空历史）
    └── 关于（版本、链接、检查更新）
```

---

## 六、数据模型

### ClipboardItem

| 字段 | 类型 | 说明 |
|------|------|------|
| id | TEXT (UUID) | 主键 |
| content_type | TEXT | plain_text / rich_text / image / file |
| plain_text | TEXT | 纯文本内容（富文本也提取纯文本用于搜索） |
| rich_content | TEXT | 富文本 HTML 内容 |
| thumbnail | BLOB | 缩略图二进制数据（400px 宽） |
| image_path | TEXT | 原图文件系统路径 |
| file_path | TEXT | 文件路径 |
| file_name | TEXT | 文件名 |
| source_app | TEXT | 来源应用标识符（bundle ID） |
| source_app_name | TEXT | 来源应用显示名 |
| content_size | INTEGER | 内容大小（字节） |
| content_hash | TEXT | SHA-256 哈希（用于去重） |
| is_favorited | BOOLEAN | 是否收藏 |
| created_at | DATETIME | 复制时间 |
| updated_at | DATETIME | 更新时间 |

### Settings

| 字段 | 类型 | 说明 |
|------|------|------|
| key | TEXT | 设置键名 |
| value | TEXT | 设置值 |

### 存储方案

- 数据库：SQLite（WAL 模式，5 连接池）
- 图片：缩略图 → DB blob，原图 → `{app_data}/images/{YYYY-MM}/{uuid}.png`
- 数据库位置：
  - macOS: `~/Library/Application Support/com.recopy.app/`
  - Windows: `%APPDATA%/com.recopy.app/`
- 搜索：FTS5 standalone 模式 + trigram tokenizer

---

## 附录 A：用户操作流程

### 流程 1：基础复制-查找-粘贴

```
1. 用户在浏览器中复制一段文字    → Recopy 后台自动记录
2. 用户继续工作，复制了其他内容    → 继续记录
3. 用户需要找回之前的文字        → 按 Cmd+Shift+V 呼出面板
4. 面板打开，显示卡片流历史       → 直接输入关键词搜索
5. 找到目标卡片                → 按回车
6. 内容粘贴到当前 App，面板关闭
```

### 流程 2：收藏常用内容

```
1. 用户复制公司地址              → Recopy 记录
2. 呼出面板，找到该条目           → 右键 → 收藏
3. 以后需要时                   → 呼出面板 → 切换到 Pins 视图 → 直接粘贴
```

### 流程 3：复制到剪贴板（不自动粘贴）

```
1. 呼出面板，找到目标卡片
2. 右键 → 复制到剪贴板（或 Cmd+C）
3. 面板不关闭，HUD 显示"已复制"反馈
4. 手动到目标 App 粘贴
```
